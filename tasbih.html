<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PULSE PRAY | النسخة البلاتينية 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&family=Cairo:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #050505;
            --surface: rgba(255, 255, 255, 0.03);
            --accent: #FFD700;
            --accent-glow: rgba(255, 215, 0, 0.5);
            --text-main: #ffffff;
            --text-muted: #b0b0b0;
            --glass-border: rgba(255, 255, 255, 0.08);
            --stage-bg: radial-gradient(circle at center, #111 0%, #000 100%);
            --safe-area-inset-top: env(safe-area-inset-top, 0px);
        }

        [data-theme="light"] {
            --bg: #f0f2f5;
            --surface: rgba(255, 255, 255, 0.9);
            --accent: #8b6e00;
            --text-main: #1a1a1a;
            --text-muted: #444;
            --stage-bg: #f0f2f5;
            --glass-border: rgba(0, 0, 0, 0.1);
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Cairo', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            transition: background 0.5s ease;
        }

        /* Navigation */
        .nav-header {
            position: fixed; top: 0; left: 0; right: 0; 
            padding: calc(15px + var(--safe-area-inset-top)) 20px 15px;
            display: flex; justify-content: space-between; align-items: center; z-index: 4000;
            backdrop-filter: blur(15px); border-bottom: 1px solid var(--glass-border);
        }

        .icon-btn {
            background: var(--surface); border: 1px solid var(--glass-border);
            color: var(--text-main); width: 42px; height: 42px; border-radius: 12px; 
            cursor: pointer; display: grid; place-items: center; transition: 0.3s;
        }
        .icon-btn:active { transform: scale(0.9); background: var(--accent); color: #000; }

        /* Sidebar */
        .sidebar {
            position: fixed; top: 0; right: -100%; width: 85%; max-width: 350px; height: 100%;
            background: rgba(10, 10, 10, 0.95); z-index: 5000; padding: 40px 20px; 
            backdrop-filter: blur(25px); border-left: 2px solid var(--accent);
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .sidebar.active { right: 0; box-shadow: -20px 0 60px rgba(0,0,0,0.9); }

        /* Pages System */
        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; 
            padding: 100px 20px 120px; overflow-y: auto; overflow-x: hidden;
        }
        .page.active { display: flex; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Modern Cards */
        .card {
            background: var(--surface); width: 100%; max-width: 450px; 
            padding: 20px; border-radius: 28px; margin-bottom: 15px;
            border: 1px solid var(--glass-border); backdrop-filter: blur(10px);
            transition: 0.3s;
        }
        .card:active { transform: scale(0.98); }

        /* 3D Wood Rosary */
        .wood-container {
            height: 350px; width: 100%; display: flex; justify-content: center; align-items: center;
            perspective: 1200px; margin: 20px 0;
        }
        #woodEngine {
            position: relative; width: 200px; height: 200px;
            transform-style: preserve-3d; transition: transform 0.4s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        .bead {
            position: absolute; width: 65px; height: 65px;
            background: radial-gradient(circle at 30% 30%, #a67c52, #4e342e);
            border-radius: 50%; box-shadow: inset -5px -5px 15px rgba(0,0,0,0.5), 5px 10px 20px rgba(0,0,0,0.4);
        }

        /* Digital Rosary */
        .digital-device {
            width: 260px; height: 360px; background: #1a1a1a; border-radius: 40px 40px 100px 100px;
            border: 8px solid #333; display: flex; flex-direction: column; align-items: center;
            padding: 25px; box-shadow: 0 40px 60px rgba(0,0,0,0.7);
        }
        .lcd-screen {
            width: 100%; height: 90px; background: #94a394; border: 6px solid #000;
            border-radius: 12px; color: #111; font-family: 'Orbitron'; font-size: 3rem;
            display: flex; align-items: center; justify-content: center;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.4); margin-bottom: 30px;
        }
        .btn-trigger {
            width: 130px; height: 130px; background: radial-gradient(#d4af37, #8b6e00);
            border-radius: 50%; border: 6px solid #222; cursor: pointer;
            box-shadow: 0 10px 0 #111; transition: 0.1s;
        }
        .btn-trigger:active { transform: translateY(6px); box-shadow: 0 4px 0 #111; }

        /* Stats & Counter */
        #sessionCount { font-family: 'Orbitron'; font-size: 5rem; font-weight: 900; color: var(--accent); margin: 10px 0; }
        
        /* Habits Grid */
        .habit-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; width: 100%; }
        .day-box { 
            aspect-ratio: 1; background: var(--surface); border-radius: 12px; 
            display: grid; place-items: center; font-weight: bold; font-size: 0.9rem;
            border: 1px solid var(--glass-border); cursor: pointer;
        }
        .day-box.completed { background: var(--accent); color: #000; border-color: var(--accent); }

        /* Footer */
        .global-footer {
            position: fixed; bottom: 0; width: 100%; padding: 20px;
            background: linear-gradient(transparent, var(--bg));
            text-align: center; pointer-events: none;
        }
        .total-badge {
            background: var(--surface); padding: 8px 20px; border-radius: 50px;
            border: 1px solid var(--accent); display: inline-block; pointer-events: auto;
        }

        .dhikr-tabs {
            display: flex; gap: 10px; overflow-x: auto; width: 100%; padding: 10px 0;
            scrollbar-width: none;
        }
        .dhikr-tabs::-webkit-scrollbar { display: none; }
        .tab {
            padding: 8px 20px; background: var(--surface); border-radius: 50px;
            white-space: nowrap; border: 1px solid var(--glass-border); font-size: 0.9rem;
        }
        .tab.active { background: var(--accent); color: #000; font-weight: bold; }
    </style>
</head>
<body data-theme="dark">

<nav class="nav-header">
    <button class="icon-btn" onclick="toggleSidebar(true)"><i class="fa-solid fa-bars-staggered"></i></button>
    <div style="text-align: center;">
        <span id="userGreeting" style="color: var(--accent); font-weight: 900;">يا ذاكر الله</span>
        <div id="activePageName" style="font-size: 0.6rem; text-transform: uppercase; opacity: 0.6; letter-spacing: 1px;">الرئيسية</div>
    </div>
    <button class="icon-btn" onclick="toggleTheme()"><i class="fa-solid fa-moon"></i></button>
</nav>

<aside class="sidebar" id="sidebar">
    <div style="margin-bottom: 30px;">
        <input type="text" id="nameInp" placeholder="اسمك الكريم.." 
               style="width:100%; background:rgba(255,255,255,0.05); border:1px solid var(--accent); padding:15px; border-radius:15px; color:white; text-align:center;">
    </div>
    <div class="sidebar-menu">
        <div class="card" onclick="showPage('home')"><i class="fa-solid fa-house"></i> &nbsp; لوحة التحكم</div>
        <div class="card" onclick="showPage('tasbih')"><i class="fa-solid fa-fingerprint"></i> &nbsp; المسبحة المتطورة</div>
        <div class="card" onclick="showPage('azkar')"><i class="fa-solid fa-book-open"></i> &nbsp; حصن المسلم</div>
        <div class="card" onclick="showPage('ramadan')"><i class="fa-solid fa-calendar-star"></i> &nbsp; خطة الـ 30 يوم</div>
        <div class="card" onclick="showPage('zakat')"><i class="fa-solid fa-hand-holding-dollar"></i> &nbsp; حاسبة الزكاة</div>
    </div>
    <button class="card" onclick="toggleSidebar(false)" style="margin-top: 20px; background: #ff4444; color: white;">إغلاق القائمة</button>
</aside>

<div id="home" class="page active">
    <div class="card" style="background: linear-gradient(45deg, #1a1a1a, #000); border-color: var(--accent);">
        <h2 style="margin: 0; font-family: 'Orbitron'; color: var(--accent);">PULSE PRAY</h2>
        <p style="opacity: 0.7;">رَفِيقُكَ فِي طَرِيقِ الذِّكْرِ</p>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 450px;">
        <div class="card" onclick="startTasbih('wood')">
            <i class="fa-solid fa-circle-nodes" style="font-size: 2rem; color: var(--accent);"></i>
            <h4>خشبية</h4>
        </div>
        <div class="card" onclick="startTasbih('digital')">
            <i class="fa-solid fa-bolt" style="font-size: 2rem; color: var(--accent);"></i>
            <h4>رقمية</h4>
        </div>
    </div>
</div>

<div id="tasbih" class="page">
    <div class="dhikr-tabs" id="dhikrTabs"></div>
    
    <div id="sessionCount">0</div>

    <div class="wood-container" id="woodView">
        <div id="woodEngine"></div>
    </div>

    <div class="digital-device" id="digitalView" style="display:none">
        <div class="lcd-screen" id="lcd">0000</div>
        <div class="btn-trigger" onclick="countAction()"></div>
    </div>

    <div style="display:flex; gap:10px; margin-top: 20px;">
        <button class="icon-btn" onclick="resetSession()"><i class="fa-solid fa-rotate-left"></i></button>
        <button class="icon-btn" onclick="toggleTasbihMode()"><i class="fa-solid fa-arrows-rotate"></i></button>
    </div>
</div>

<div id="ramadan" class="page">
    <div class="card">
        <h3>تحدي رمضان 2026</h3>
        <p>انجز مهامك اليومية واضغط على اليوم المقابل</p>
        <div class="habit-grid" id="habitGrid"></div>
    </div>
</div>

<div id="zakat" class="page">
    <div class="card">
        <h3>حاسبة الزكاة الذكية</h3>
        <p>أدخل المبلغ المالي (مر عليه حول كامل):</p>
        <input type="number" id="money" class="card" style="width:100%; text-align:center; font-size:1.5rem;" placeholder="0.00" oninput="calculateZakat()">
        <div style="text-align: center; margin-top: 20px;">
            <small>مقدار الزكاة المستحق:</small>
            <div id="zakatResult" style="font-size: 2.5rem; color: var(--accent); font-weight: 900;">0.00</div>
        </div>
    </div>
</div>

<footer class="global-footer">
    <div class="total-badge">
        <small style="display:block; opacity: 0.6; font-size: 0.6rem;">مجموع التسبيح الكلي</small>
        <span id="grandTotal" style="font-family: 'Orbitron'; font-weight: 900; color: var(--accent);">0</span>
    </div>
</footer>

<script>
    // Configuration & State
    const ADHKAR = ["سبحان الله", "الحمد لله", "الله أكبر", "لا إله إلا الله", "أستغفر الله", "صلِ على محمد"];
    let state = {
        count: 0,
        grandTotal: parseInt(localStorage.getItem('pp_grand')) || 0,
        mode: 'wood',
        angle: 0,
        habits: JSON.parse(localStorage.getItem('pp_habits')) || [],
        name: localStorage.getItem('pp_name') || "ذاكر الله"
    };

    // Initialize
    window.onload = () => {
        setupWoodBeads();
        setupDhikrTabs();
        setupHabitGrid();
        updateUI();
        
        document.getElementById('nameInp').value = state.name;
        document.getElementById('nameInp').addEventListener('input', (e) => {
            state.name = e.target.value;
            localStorage.setItem('pp_name', state.name);
            updateUI();
        });
    };

    function setupWoodBeads() {
        const engine = document.getElementById('woodEngine');
        engine.innerHTML = '';
        for (let i = 0; i < 12; i++) {
            const bead = document.createElement('div');
            bead.className = 'bead';
            bead.style.transform = `rotateX(${i * 30}deg) translateZ(120px)`;
            bead.onclick = countAction;
            engine.appendChild(bead);
        }
    }

    function setupDhikrTabs() {
        const container = document.getElementById('dhikrTabs');
        ADHKAR.forEach((text, i) => {
            const tab = document.createElement('div');
            tab.className = `tab ${i === 0 ? 'active' : ''}`;
            tab.innerText = text;
            tab.onclick = () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                vibrate(30);
            };
            container.appendChild(tab);
        });
    }

    function countAction() {
        state.count++;
        state.grandTotal++;
        
        // Haptic & Sound logic
        vibrate(state.count % 33 === 0 ? 150 : 40);
        
        if (state.mode === 'wood') {
            state.angle -= 30;
            document.getElementById('woodEngine').style.transform = `rotateX(${state.angle}deg)`;
        }

        saveData();
        updateUI();
    }

    function updateUI() {
        document.getElementById('sessionCount').innerText = state.count;
        document.getElementById('lcd').innerText = state.count.toString().padStart(4, '0');
        document.getElementById('grandTotal').innerText = state.grandTotal.toLocaleString();
        document.getElementById('userGreeting').innerText = `يا ${state.name}`;
    }

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('activePageName').innerText = id;
        toggleSidebar(false);
    }

    function toggleSidebar(show) {
        document.getElementById('sidebar').classList.toggle('active', show);
    }

    function startTasbih(mode) {
        state.mode = mode;
        document.getElementById('woodView').style.display = mode === 'wood' ? 'flex' : 'none';
        document.getElementById('digitalView').style.display = mode === 'digital' ? 'flex' : 'none';
        showPage('tasbih');
    }

    function toggleTasbihMode() {
        startTasbih(state.mode === 'wood' ? 'digital' : 'wood');
    }

    function resetSession() {
        if(confirm("تصفير العداد الحالي؟")) {
            state.count = 0;
            updateUI();
        }
    }

    function setupHabitGrid() {
        const grid = document.getElementById('habitGrid');
        grid.innerHTML = '';
        for (let i = 1; i <= 30; i++) {
            const day = document.createElement('div');
            day.className = `day-box ${state.habits.includes(i) ? 'completed' : ''}`;
            day.innerText = i;
            day.onclick = () => {
                if (state.habits.includes(i)) {
                    state.habits = state.habits.filter(d => d !== i);
                } else {
                    state.habits.push(i);
                    vibrate(70);
                }
                localStorage.setItem('pp_habits', JSON.stringify(state.habits));
                setupHabitGrid();
            };
            grid.appendChild(day);
        }
    }

    function calculateZakat() {
        const val = document.getElementById('money').value;
        document.getElementById('zakatResult').innerText = (val * 0.025).toFixed(2);
    }

    function toggleTheme() {
        const current = document.body.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.body.setAttribute('data-theme', next);
        document.querySelector('.fa-moon').className = next === 'dark' ? 'fa-solid fa-moon' : 'fa-solid fa-sun';
    }

    function saveData() {
        localStorage.setItem('pp_grand', state.grandTotal);
    }

    function vibrate(ms) {
        if (navigator.vibrate) navigator.vibrate(ms);
    }
</script>
</body>
</html>
